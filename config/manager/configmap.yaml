apiVersion: v1
kind: ConfigMap
metadata:
  name: wva-variantautoscaling-config
  namespace: workload-variant-autoscaler-system
  labels:
    app.kubernetes.io/name: workload-variant-autoscaler
    app.kubernetes.io/managed-by: kustomize
data:
  # Prometheus configuration - REQUIRED: Set your Prometheus server URL
  # Examples:
  # - General: "https://prometheus:9090"
  # - OpenShift: "https://thanos-querier.openshift-monitoring.svc.cluster.local:9091"
  # - KIND cluster: "https://kube-prometheus-stack-prometheus.workload-variant-autoscaler-monitoring.svc.cluster.local:9090"
  PROMETHEUS_BASE_URL: "https://kube-prometheus-stack-prometheus.workload-variant-autoscaler-monitoring.svc.cluster.local:9090"

  # TLS Configuration (TLS is always enabled for HTTPS-only support)
  # PROMETHEUS_TLS_INSECURE_SKIP_VERIFY: "true"  # Skip certificate verification (development/testing only)
  # PROMETHEUS_CA_CERT_PATH: "/path/to/ca.crt"   # CA certificate for server validation
  # PROMETHEUS_CLIENT_CERT_PATH: "/path/to/client.crt"  # Client certificate for mutual TLS
  # PROMETHEUS_CLIENT_KEY_PATH: "/path/to/client.key"   # Client private key for mutual TLS
  # PROMETHEUS_SERVER_NAME: "prometheus.example.com"    # Expected server name for SNI
  PROMETHEUS_TLS_INSECURE_SKIP_VERIFY: "true"

  # Authentication Configuration (BearerToken takes precedence over TokenPath)
  # PROMETHEUS_BEARER_TOKEN: "your-token-here"           # Direct bearer token (development/testing)
  # PROMETHEUS_TOKEN_PATH: "/path/to/token/file"        # Path to bearer token file (production with mounted secrets)

  # Optimization configuration
  GLOBAL_OPT_INTERVAL: "60s"

  # Option to scale variants to zero replicas (default: true)
  WVA_SCALE_TO_ZERO: "false"
  # Option to use experimental hybrid optimization (default: "off")

  # Prometheus metrics cache configuration
  # Each collector (Prometheus, EPP, etc.) has its own cache configuration
  # Prometheus cache TTL - how long metrics are cached before expiring (default: "30s")
  PROMETHEUS_METRICS_CACHE_TTL: "30s"
  # Maximum number of Prometheus cache entries (0 = unlimited, default: "0")
  PROMETHEUS_METRICS_CACHE_MAX_SIZE: "0"
  # Interval for background cleanup of expired Prometheus cache entries (default: "1m")
  PROMETHEUS_METRICS_CACHE_CLEANUP_INTERVAL: "1m"
  # Background fetch interval - how often to fetch metrics in background (default: "30s", 0 = disable)
  PROMETHEUS_METRICS_CACHE_FETCH_INTERVAL: "30s"
  # Freshness thresholds - when metrics are considered fresh/stale/unavailable
  PROMETHEUS_METRICS_CACHE_FRESH_THRESHOLD: "1m"
  PROMETHEUS_METRICS_CACHE_STALE_THRESHOLD: "2m"
  PROMETHEUS_METRICS_CACHE_UNAVAILABLE_THRESHOLD: "5m"

  # EPP metrics cache configuration (for future EPP collector)
  # EPP_METRICS_CACHE_ENABLED: "true"
  # EPP_METRICS_CACHE_TTL: "15s"
  # EPP_METRICS_CACHE_MAX_SIZE: "500"
  # EPP_METRICS_CACHE_CLEANUP_INTERVAL: "30s"
  WVA_LIMITED_MODE: "false"
  WVA_NODE_SELECTOR: ""
